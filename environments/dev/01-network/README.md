# Terraform 실행 가이드 🛠️

## 📦 목적

Terraform 코드를 변경한 후, 실제 인프라에 바로 적용하기 전에 **무엇이 어떻게 바뀔지** 미리 확인하고 안전하게 반영하기 위한 권장 절차입니다.

---

## 🔧 실행 순서 & 명령어

| 단계                  | 명령어                                                                     | 설명                                                                                                                                                                   |
| --------------------- | -------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **1. Plan 저장**      | `terraform plan -out=tfplan`                                               | 현재 Terraform 설정 기준으로 변경될 리소스 생성 / 변경 / 삭제 계획을 생성하고, 그 결과를 `tfplan` 파일 (바이너리) 로 저장합니다. :contentReference[oaicite:0]{index=0} |
| **2. Plan 결과 검토** | `terraform show tfplan`                                                    | `tfplan` 파일을 사람이 읽을 수 있는 형태로 출력 — 어떤 리소스에 어떤 변화가 생기는지 미리 확인 가능. :contentReference[oaicite:1]{index=1}                             |
|                       | `terraform show -json tfplan \| jq '.'`                                    | JSON 포맷으로 plan 결과를 출력 — 자동화 스크립트, 리뷰 또는 체계적인 검토용으로 유용.                                                                                  |
| **3. 확신 후 Apply**  | `terraform apply tfplan`<br>또는<br>`terraform apply -auto-approve tfplan` | 미리 검토한 plan을 그대로 적용하여 인프라 변경 수행. 실제 리소스 생성/변경/삭제가 이루어집니다. :contentReference[oaicite:2]{index=2}                                  |

---

## ✅ 언제 이 흐름을 쓰는가

- 중요한 리소스를 변경할 때 (예: EKS, RDS, 네트워크, IAM 등)
- 변경사항이 많거나 복잡한 업데이트를 할 때
- 변경 결과가 실제 인프라에 미칠 영향이 클 때
- 팀원이나 동료에게 변경 내역을 공유하고 리뷰가 필요한 경우
- 운영 환경 또는 production에 반영하기 전에 안정성/예측 가능성을 확보하고 싶을 때

---

## 💡 왜 이렇게 사용하면 좋은가 — 장점

- **사전 검토 & 안전망 확보** : 변경 적용 전에 어떤 리소스가 어떻게 바뀌는지 명확히 파악 가능 → 실수나 의도치 않은 삭제/변경 방지 :contentReference[oaicite:3]{index=3}
- **투명성 및 팀 협업 강화** : `tfplan` 을 파일로 저장하고, 리뷰/승인 프로세스에 포함시킬 수 있어 팀 내 변경 히스토리와 책임소재가 명확해짐 :contentReference[oaicite:4]{index=4}
- **자동화 & CI/CD 친화** : JSON 출력 + 스크립트 분석 + 조건 검증 등을 통해 배포 파이프라인에 통합 가능 (예: “destroy 금지”, “태그 규칙 준수”, “비용 예산 초과 금지” 등 자동 가드레일 구성) :contentReference[oaicite:5]{index=5}
- **예측가능한 인프라 변화 적용** : 사람이 직접 “apply → 결과 확인” 보다, “plan → 검토 → apply” 흐름이 훨씬 안정적이고 실수를 줄임

---

## ⚠️ 유의사항 & 체크리스트

- `terraform plan -out=tfplan` 시점의 변수 값(.tfvars), backend 설정, provider 설정 등이 **apply 시점까지 변경되지 않아야 함** — 그렇지 않으면 plan 결과와 실제 적용이 달라질 수 있음
- `tfplan` 파일이나 JSON 출력에는 리소스 설정 정보가 포함되므로 — 민감 정보(secret, credential 등)가 함께 노출되지 않도록 주의
- 변경 리소스가 많거나 복잡하면 출력이 방대해질 수 있음 — `jq`, `grep` 등의 도구로 “변경된 리소스만 필터링하여 보기”를 권장
- 팀/환경이 여러 개일 경우, 어떤 환경에서 plan/ apply 했는지 명확히 기록하고 관리

---
